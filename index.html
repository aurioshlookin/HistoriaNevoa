<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>História da Névoa | Nin Online (Hawk)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* Fontes Personalizadas */
        h1, h2, h3, .brand-font { font-family: 'Cinzel', serif; }
        body { font-family: 'Lato', sans-serif; }

        /* Scrollbar Personalizada */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Animações */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Fundo com efeito de Névoa */
        .mist-bg {
            background-color: #0f172a;
            background-image: 
                radial-gradient(at 0% 0%, rgba(56, 189, 248, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%);
            background-attachment: fixed;
        }

        /* Estilos do submenu */
        .sub-menu-btn {
            padding-left: 2.5rem;
            font-size: 0.85rem;
            border-left: 2px solid #1e293b;
        }
        .sub-menu-btn:hover {
            border-left-color: #38bdf8;
        }
        .sub-menu-container {
            margin-left: 0.5rem;
            margin-top: 0.25rem;
            margin-bottom: 0.5rem;
        }

        /* Classes para conteúdo carregado dinamicamente */
        blockquote {
            border-left: 4px solid #38bdf8;
            padding-left: 1rem;
            font-style: italic;
            color: #94a3b8;
            background: rgba(30, 41, 59, 0.5);
            padding: 1rem;
            border-radius: 0 0.5rem 0.5rem 0;
            margin: 1.5rem 0;
        }
        
        /* Modo Edição */
        .editable-active:hover {
            outline: 2px dashed #38bdf8;
            background-color: rgba(56, 189, 248, 0.1);
            cursor: text;
        }
        
        /* Ocultar controles de edição por padrão */
        .edit-controls {
            display: none !important;
        }
        
        /* Mostrar controles apenas quando logado */
        body.admin-mode .edit-controls {
            display: inline-block !important;
        }
        
        /* Placeholder de Imagem */
        .img-placeholder {
            border: 2px dashed #475569;
            background: rgba(30, 41, 59, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            margin: 1rem 0;
            flex-direction: column;
        }
    </style>
</head>
<body class="mist-bg text-slate-200 min-h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- Cabeçalho Mobile -->
    <div class="md:hidden bg-slate-900 border-b border-slate-700 p-4 flex justify-between items-center z-30">
        <span class="text-xl font-bold brand-font text-sky-400">Vila da Névoa</span>
        <button onclick="toggleSidebar()" class="text-slate-200 focus:outline-none">
            <i class="fas fa-bars text-2xl"></i>
        </button>
    </div>

    <!-- Barra Lateral -->
    <aside id="sidebar" class="transform -translate-x-full md:translate-x-0 fixed md:relative z-40 w-64 h-full bg-slate-900/95 border-r border-slate-700 transition-transform duration-300 ease-in-out flex flex-col shadow-2xl">
        <div class="p-6 border-b border-slate-700 hidden md:block">
            <h1 class="text-2xl font-bold brand-font text-sky-400 tracking-wider text-center">
                <i class="fas fa-water mr-2"></i>Kirigakure
            </h1>
            <p class="text-xs text-slate-500 text-center mt-1">História da Névoa no Servidor Hawk</p>
        </div>

        <nav class="flex-1 overflow-y-auto p-4 space-y-2">
            <button onclick="loadPage('intro.html')" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors text-slate-300 hover:text-sky-300 border-l-2 border-transparent hover:border-sky-500">
                <i class="fas fa-scroll w-6 text-center"></i> Introdução
            </button>
            <button onclick="loadPage('chapter1.html')" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors text-slate-300 hover:text-sky-300 border-l-2 border-transparent hover:border-sky-500">
                <i class="fas fa-torii-gate w-6 text-center"></i> Cap. 1: O Início
            </button>
            
            <div class="pt-2 pb-1">
                <p class="px-4 text-xs font-bold text-slate-500 uppercase tracking-widest">A Era Acqua</p>
            </div>
            
            <button onclick="toggleSubMenu('submenu-chap2'); loadPage('chapter2.html')" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors text-slate-300 hover:text-sky-300 border-l-2 border-transparent hover:border-sky-500 flex justify-between items-center">
                <span><i class="fas fa-water w-6 text-center"></i> Cap. 2: Shodai Mizukami</span>
                <i class="fas fa-chevron-down text-xs transition-transform" id="icon-submenu-chap2"></i>
            </button>
            
            <div id="submenu-chap2" class="sub-menu-container hidden flex-col space-y-1">
                <!-- Botões para rolar até as seções (funciona após carregar a página) -->
                <button onclick="scrollToSection('sec-2-1')" class="sub-menu-btn w-full text-left py-2 rounded hover:text-sky-300 text-slate-400 transition-colors">2.1 Início do Mandato</button>
                <button onclick="scrollToSection('sec-2-2')" class="sub-menu-btn w-full text-left py-2 rounded hover:text-sky-300 text-slate-400 transition-colors">2.2 Conflitos em Asoki</button>
                <button onclick="scrollToSection('sec-2-3')" class="sub-menu-btn w-full text-left py-2 rounded hover:text-sky-300 text-slate-400 transition-colors">2.3 Torneio Sannin</button>
                <button onclick="scrollToSection('sec-2-4')" class="sub-menu-btn w-full text-left py-2 rounded hover:text-sky-300 text-slate-400 transition-colors">2.4 Kami Summit</button>
                <button onclick="scrollToSection('sec-2-5')" class="sub-menu-btn w-full text-left py-2 rounded hover:text-sky-300 text-slate-400 transition-colors">2.5 Brasileirão</button>
                <button onclick="scrollToSection('sec-2-6')" class="sub-menu-btn w-full text-left py-2 rounded hover:text-sky-300 text-slate-400 transition-colors">2.6 Eleições</button>
                <button onclick="scrollToSection('sec-2-7')" class="sub-menu-btn w-full text-left py-2 rounded hover:text-sky-300 text-slate-400 transition-colors">2.7 Exame Chunin</button>
                <button onclick="scrollToSection('sec-2-8')" class="sub-menu-btn w-full text-left py-2 rounded hover:text-sky-300 text-slate-400 transition-colors">2.8 Segunda Guerra</button>
            </div>

            <div class="pt-2 pb-1">
                <p class="px-4 text-xs font-bold text-slate-500 uppercase tracking-widest">A Era Kirisaki</p>
            </div>

            <button onclick="loadPage('chapter3.html')" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors text-slate-300 hover:text-sky-300 border-l-2 border-transparent hover:border-sky-500">
                <i class="fas fa-spider w-6 text-center"></i> Cap. 3: O Nidaime
            </button>
        </nav>

        <!-- Área de Admin -->
        <div class="p-4 border-t border-slate-700 bg-slate-900">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-sky-900 flex items-center justify-center text-sky-200 font-bold">A</div>
                    <div>
                        <p class="text-sm font-bold text-slate-200">Auriosh</p>
                        <p class="text-xs text-slate-500">Autor & Historiador</p>
                    </div>
                </div>
                <button id="loginBtn" onclick="openLoginModal()" class="text-slate-600 hover:text-sky-400 p-2" title="Área de Edição"><i class="fas fa-cog"></i></button>
            </div>
            
            <div id="adminPanel" class="hidden mt-4 pt-4 border-t border-slate-700">
                <p class="text-xs text-green-400 font-bold mb-2 flex items-center"><i class="fas fa-circle text-[8px] mr-2"></i> MODO EDIÇÃO ATIVO</p>
                <button onclick="saveCurrentChapter()" class="w-full bg-green-700 hover:bg-green-600 text-white text-xs font-bold py-2 px-2 rounded mb-2 transition-colors">
                    <i class="fas fa-save mr-1"></i> Salvar Capítulo Atual
                </button>
                <button onclick="logout()" class="w-full bg-red-700 hover:bg-red-600 text-white text-xs font-bold py-2 px-2 rounded transition-colors">
                    <i class="fas fa-sign-out-alt mr-1"></i> Sair do Modo Edição
                </button>
                <p class="text-[10px] text-slate-500 text-center mt-2">Salva as alterações do capítulo atual em um arquivo HTML.</p>
            </div>
        </div>
    </aside>

    <!-- Modal de Login -->
    <div id="loginModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80">
        <div class="bg-slate-800 p-6 rounded-lg shadow-2xl border border-slate-600 w-80">
            <h3 class="text-xl font-bold text-white mb-4">Acesso Administrativo</h3>
            <input type="password" id="adminPassword" placeholder="Senha..." class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white mb-4 focus:outline-none focus:border-sky-500">
            <div class="flex justify-end space-x-2">
                <button onclick="closeLoginModal()" class="px-4 py-2 text-slate-400 hover:text-white">Cancelar</button>
                <button onclick="checkLogin()" class="px-4 py-2 bg-sky-600 hover:bg-sky-500 text-white rounded font-bold">Entrar</button>
            </div>
        </div>
    </div>

    <!-- Container Dinâmico -->
    <main class="flex-1 h-screen overflow-y-auto relative scroll-smooth" id="content-area">
        <div class="max-w-4xl mx-auto p-6 md:p-12 pb-24" id="dynamic-content">
            <!-- O conteúdo será carregado aqui -->
        </div>
    </main>

    <script>
        let currentPageName = 'intro.html'; // Padrão

        // Inicialização
        window.addEventListener('DOMContentLoaded', () => {
            loadPage('intro.html');
        });

        // Carrega arquivos externos
        async function loadPage(pageUrl) {
            currentPageName = pageUrl;
            const contentDiv = document.getElementById('dynamic-content');
            
            // Loading Spinner
            contentDiv.innerHTML = '<div class="flex flex-col items-center justify-center h-64 fade-in"><i class="fas fa-circle-notch fa-spin text-4xl text-sky-500 mb-4"></i><p class="text-slate-400">Invocando pergaminho...</p></div>';

            try {
                const response = await fetch(pageUrl);
                if (!response.ok) throw new Error('Falha no carregamento');
                
                const html = await response.text();
                contentDiv.innerHTML = '<div class="fade-in">' + html + '</div>';
                
                // Reaplicar estado de admin se necessário
                if(document.body.classList.contains('admin-mode')) {
                    enableAdminMode();
                }

                // Scroll to top
                document.getElementById('content-area').scrollTo({ top: 0, behavior: 'smooth' });

            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="bg-red-900/20 border border-red-700 p-6 rounded-lg text-center mt-10">
                        <i class="fas fa-exclamation-triangle text-3xl text-red-500 mb-2"></i>
                        <h3 class="text-xl font-bold text-red-400">Erro de Conexão</h3>
                        <p class="text-slate-300 mt-2">Não foi possível carregar o arquivo <strong>${pageUrl}</strong>.</p>
                        <p class="text-slate-500 text-sm mt-4 bg-black/30 p-2 rounded">
                            Nota: Se você está abrindo o index.html direto no computador, os navegadores bloqueiam isso (CORS). 
                            Suba os arquivos para o GitHub ou use um Local Server.
                        </p>
                    </div>
                `;
            }

            if(window.innerWidth < 768) toggleSidebar();
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('-translate-x-full');
        }

        function toggleSubMenu(menuId) {
            const menu = document.getElementById(menuId);
            const icon = document.getElementById('icon-' + menuId);
            
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                menu.classList.add('flex');
                if(icon) icon.classList.add('rotate-180');
            } else {
                menu.classList.add('hidden');
                menu.classList.remove('flex');
                if(icon) icon.classList.remove('rotate-180');
            }
        }

        // Rolar para seção específica (carrega o capítulo 2 se necessário)
        async function scrollToSection(sectionId) {
            if (currentPageName !== 'chapter2.html') {
                await loadPage('chapter2.html');
                // Pequeno delay para renderizar
                setTimeout(() => findAndScroll(sectionId), 100);
            } else {
                findAndScroll(sectionId);
            }
        }

        function findAndScroll(id) {
            const el = document.getElementById(id);
            if(el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        /* --- Lógica de Admin (Adaptada para Multi-arquivos) --- */
        
        function openLoginModal() { document.getElementById('loginModal').classList.remove('hidden'); }
        function closeLoginModal() { document.getElementById('loginModal').classList.add('hidden'); }
        
        function checkLogin() {
            const p = document.getElementById('adminPassword').value;
            if (p === "igor123") {
                loginSuccess();
            } else {
                alert("Senha incorreta.");
            }
        }

        function loginSuccess() {
            document.body.classList.add('admin-mode');
            document.getElementById('adminPanel').classList.remove('hidden');
            document.getElementById('loginBtn').classList.add('hidden'); // Esconde botão de engrenagem
            enableAdminMode();
            closeLoginModal();
            alert("Modo Edição Ativado!");
        }

        function logout() {
            document.body.classList.remove('admin-mode');
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('loginBtn').classList.remove('hidden'); // Mostra botão de engrenagem
            
            // Remove editabilidade
            const editables = document.querySelectorAll('.editable-text');
            editables.forEach(el => {
                el.removeAttribute('contenteditable');
                el.classList.remove('editable-active');
            });
            
            alert("Você saiu do modo de edição.");
        }

        function enableAdminMode() {
            // Só ativa se a classe admin-mode estiver no body (verificação dupla)
            if(!document.body.classList.contains('admin-mode')) return;

            const editables = document.querySelectorAll('.editable-text');
            editables.forEach(el => {
                el.contentEditable = "true";
                el.classList.add('editable-active');
            });
        }

        function editVideo(btn) {
            if(!document.body.classList.contains('admin-mode')) return;
            const container = btn.closest('.video-container');
            const iframe = container.querySelector('iframe');
            let newSrc = prompt("Nova URL Embed do YouTube:", iframe.src);
            if (newSrc) {
                if(newSrc.includes("youtube.com/embed")) newSrc = newSrc.replace("youtube.com", "youtube-nocookie.com");
                iframe.src = newSrc;
            }
        }

        function insertImage(btn) {
            if(!document.body.classList.contains('admin-mode')) return;
            const placeholder = btn.closest('.img-placeholder');
            const url = prompt("URL da Imagem:");
            if (url) {
                const imgContainer = placeholder.parentElement;
                imgContainer.innerHTML = `<div class="relative group"><img src="${url}" class="w-full rounded shadow-lg my-4"><button onclick="this.parentElement.parentElement.innerHTML = createPlaceholderHTML()" class="absolute top-2 right-2 bg-red-600 text-white text-xs px-2 py-1 rounded opacity-75 hover:opacity-100 edit-controls">Remover</button></div>`;
            }
        }

        // Função auxiliar para recriar o placeholder se a imagem for removida
        function createPlaceholderHTML() {
            return `<div class="img-placeholder"><i class="fas fa-image text-3xl mb-2"></i><span class="text-sm">Espaço para Imagem</span><button class="edit-controls bg-blue-600 text-white text-xs px-3 py-1 rounded mt-2 hover:bg-blue-500" onclick="insertImage(this)">Adicionar Imagem</button></div>`;
        }

        function saveCurrentChapter() {
            const content = document.getElementById('dynamic-content');
            const clone = content.cloneNode(true);
            
            // Limpa atributos de edição
            clone.querySelectorAll('.editable-active').forEach(el => {
                el.removeAttribute('contenteditable');
                el.classList.remove('editable-active');
            });

            let htmlContent = clone.innerHTML;
            if(htmlContent.startsWith('<div class="fade-in">')) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlContent;
                htmlContent = tempDiv.firstElementChild.innerHTML;
            }

            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = currentPageName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
